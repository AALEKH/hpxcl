<!DOCTYPE html>

<html>
  <head>
    <title>Mandelbrot</title>
    <meta name="viewport" content="initial-scale=1.0, user-scalable=no">
    <meta charset="utf-8">
    <style>
      #table_left {
        height: 100%;
        width: 90%;
        margin: 0px;
        padding: 0px
      }
      #table_right {
        height: 100%;
        margin: 0px;
        padding: 0px;
        background-color: black
      }
      html, body, #map-canvas, #perf-cntr, #table_row {
        height: 100%;
        width: 100%;
        margin: 0px;
        padding: 0px
      }
      table.blind {
          width: 100%;
          height: 100%;
          margin: 0px;
          padding: 0px;
          border-collapse: collapse
      }
    </style>
    <script src="https://maps.googleapis.com/maps/api/js?v=3.exp"></script>
    <script>

        var map;
        var mandelbrotTypeOptions = {
          getTileUrl: function(coord, zoom) {
                return "/" + zoom + "/" + coord.x + "/" +
                  coord.y + ".png";
          },
          tileSize: new google.maps.Size(256, 256),
          maxZoom: 60,
          minZoom: 0,
          name: "Mandelbrot"
        };

        var mandelbrotMapType = new google.maps.ImageMapType(mandelbrotTypeOptions);

        function initialize() {
          var myLatlng = new google.maps.LatLng(0, 0);
          var mapOptions = {
            center: myLatlng,
            zoom: 1,
            streetViewControl: false,
            mapTypeControlOptions: {
              mapTypeIds: ["mandelbrot"]
            }
          };

          map = new google.maps.Map(document.getElementById("map-canvas"),
              mapOptions);
          map.mapTypes.set('mandelbrot', mandelbrotMapType);
          map.setMapTypeId('mandelbrot');
        }
        google.maps.event.addDomListener(window, 'load', initialize);

    </script>

    <script>
        function loadXMLDoc(dname)
        {
            if (window.XMLHttpRequest)
            {
                xhttp=new XMLHttpRequest();
            }
            else
            {
                xhttp=new ActiveXObject("Microsoft.XMLDOM");
            }

            xhttp.open("GET",dname,false);
            xhttp.send();
            return xhttp.responseXML;
        }
    </script>



	<script type="text/javascript">
    	window.onload = function () {
    
            var i;

            // query number of gpus
            gpu_infos = loadXMLDoc("gpu_infos.xml");
            num_gpus = parseInt(gpu_infos.getElementsByTagName("num_gpus")[0].childNodes[0].nodeValue);
            
            // create table rows
            table = document.getElementById('perf-cntrs');
            table_height = Math.min(25*num_gpus, 100);
            table.style="height: " + table_height.toString() + "%";

            for(i = 0; i < num_gpus; i++)
            {
                row = document.createElement("tr");
                col = document.createElement("td");
                div = document.createElement("div");
                div.id = "gpu_" + i.toString();
                div.style = "height: 100%; width: 100%";
                row.style = "height: " + (100.0/num_gpus) + "%";
                col.appendChild(div);
                row.appendChild(col);
                table.appendChild(row);
            }


    		var datapoints = new Array(num_gpus); // dataPoints
            var charts = new Array(num_gpus); 

            for(i = 0; i < num_gpus; i++)
            {
                // initialize data
                datapoints[i] = [{x:-1,y:0}];

                // get gpu name
                gpu_name = gpu_infos.getElementsByTagName("gpu_" + i.toString())[0].childNodes[0].nodeValue;

                // create chart
                charts[i] = new CanvasJS.Chart("gpu_" + i.toString(),{
                   title :{
                        text: gpu_name   
                   },
                   data: [{
                       type: "line",
                       dataPoints: datapoints[i]
                   }],
                   axisX:{
                       valueFormatString: " "
                   }
                });

            };

            for(i = 0; i < num_gpus; i++)
            {
                charts[i].render();
            };

    		var xVal = 0;
    		var yVal = 100;	
    		var updateInterval = 1000;
    		var dataLength = 50; // number of dataPoints visible at any point

    		var updateChart = function () {
                perfdata=loadXMLDoc("perf_data.xml");
    			
                for(i = 0; i < num_gpus; i++){
                    yVal = parseFloat(perfdata.getElementsByTagName("gpu_" + i.toString())[0].childNodes[0].nodeValue);
 				    datapoints[i].push({
                         x: xVal,
 				    	 y: yVal
 				    });

    			    if (datapoints[i].length > dataLength)
    			    {
    			    	datapoints[i].shift();				
    			    }
    			    
    			    charts[i].render();
                }
 				
                xVal++;
    
    		};

    		// update chart after specified time. 
    		setInterval(function(){updateChart()}, updateInterval); 
    
    	}
	</script>
	<script type="text/javascript" src="/canvasjs.min.js"></script>
  </head>
  <body>
    <table class="blind">
      <tr id="table_row">
        <td id="table_left">
            <div id="map-canvas"></div>
        </td>
        <td id="table_right">
            <table class="blind" id="perf-cntrs">
            </table>
        </td>
      </tr>
    </table>
  </body>
</html>


